#!/usr/bin/env python
import pyclamd
import boto3
import pprint
import sys

cd = pyclamd.ClamdNetworkSocket(host='127.0.0.1', port=8310, timeout=None)
bucketname = 'srf-formio-upload-test'

s3 = boto3.client("s3")
all_objects = s3.list_objects(Bucket = bucketname) 

for s3file in all_objects['Contents']:
    
    print(s3file['Key'])

    s3_res = boto3.resource('s3')
    obj = s3_res.Object(bucketname, s3file['Key'])
    
    result = cd.scan_stream(obj.get()['Body'].read())
    pprint.pprint(result)

sys.exit()